"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[261],{2886:function(a,b,c){c.d(b,{z:function(){return e}});var d=c(2212),e=function(a,b){void 0===b&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),b===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=a,this.domElement=b,this.enabled=!0,this.target=new d.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:d.RsA.ROTATE,MIDDLE:d.RsA.DOLLY,RIGHT:d.RsA.PAN},this.touches={ONE:d.QmN.ROTATE,TWO:d.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return k.phi},this.getAzimuthalAngle=function(){return k.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(e),c.update(),i=h.NONE},this.update=(C=new d.Pa4,D=new d._fP().setFromUnitVectors(a.up,new d.Pa4(0,1,0)),E=D.clone().inverse(),F=new d.Pa4,G=new d._fP,H=2*Math.PI,function(){var a=c.object.position;C.copy(a).sub(c.target),C.applyQuaternion(D),k.setFromVector3(C),c.autoRotate&&i===h.NONE&&A(y()),c.enableDamping?(k.theta+=l.theta*c.dampingFactor,k.phi+=l.phi*c.dampingFactor):(k.theta+=l.theta,k.phi+=l.phi);var b=c.minAzimuthAngle,d=c.maxAzimuthAngle;return isFinite(b)&&isFinite(d)&&(b< -Math.PI?b+=H:b>Math.PI&&(b-=H),d< -Math.PI?d+=H:d>Math.PI&&(d-=H),b<d?k.theta=Math.max(b,Math.min(d,k.theta)):k.theta=k.theta>(b+d)/2?Math.max(b,k.theta):Math.min(d,k.theta)),k.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,k.phi)),k.makeSafe(),k.radius*=m,k.radius=Math.max(c.minDistance,Math.min(c.maxDistance,k.radius)),!0===c.enableDamping?c.target.addScaledVector(n,c.dampingFactor):c.target.add(n),C.setFromSpherical(k),C.applyQuaternion(E),a.copy(c.target).add(C),c.object.lookAt(c.target),!0===c.enableDamping?(l.theta*=1-c.dampingFactor,l.phi*=1-c.dampingFactor,n.multiplyScalar(1-c.dampingFactor)):(l.set(0,0,0),n.set(0,0,0)),m=1,!!(o||F.distanceToSquared(c.object.position)>j||8*(1-G.dot(c.object.quaternion))>j)&&(c.dispatchEvent(e),F.copy(c.object.position),G.copy(c.object.quaternion),o=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener("contextmenu",ah,!1),c.domElement.removeEventListener("pointerdown",Y,!1),c.domElement.removeEventListener("wheel",ac,!1),c.domElement.removeEventListener("touchstart",ae,!1),c.domElement.removeEventListener("touchend",ag,!1),c.domElement.removeEventListener("touchmove",af,!1),c.domElement.ownerDocument.removeEventListener("pointermove",Z,!1),c.domElement.ownerDocument.removeEventListener("pointerup",$,!1),c.domElement.removeEventListener("keydown",ad,!1)};var c=this,e={type:"change"},f={type:"start"},g={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},i=h.NONE,j=1e-6,k=new d.$V,l=new d.$V,m=1,n=new d.Pa4,o=!1,p=new d.FM8,q=new d.FM8,r=new d.FM8,s=new d.FM8,t=new d.FM8,u=new d.FM8,v=new d.FM8,w=new d.FM8,x=new d.FM8;function y(){return 2*Math.PI/60/60*c.autoRotateSpeed}function z(){return Math.pow(.95,c.zoomSpeed)}function A(a){l.theta-=a}function B(a){l.phi-=a}var C,D,E,F,G,H,I,J,K,L=(I=new d.Pa4,function(a,b){I.setFromMatrixColumn(b,0),I.multiplyScalar(-a),n.add(I)}),M=(J=new d.Pa4,function(a,b){!0===c.screenSpacePanning?J.setFromMatrixColumn(b,1):(J.setFromMatrixColumn(b,0),J.crossVectors(c.object.up,J)),J.multiplyScalar(a),n.add(J)}),N=(K=new d.Pa4,function(a,b){var d=c.domElement;if(c.object.isPerspectiveCamera){var e=c.object.position;K.copy(e).sub(c.target);var f=K.length();L(2*a*(f*=Math.tan(c.object.fov/2*Math.PI/180))/d.clientHeight,c.object.matrix),M(2*b*f/d.clientHeight,c.object.matrix)}else c.object.isOrthographicCamera?(L(a*(c.object.right-c.object.left)/c.object.zoom/d.clientWidth,c.object.matrix),M(b*(c.object.top-c.object.bottom)/c.object.zoom/d.clientHeight,c.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),c.enablePan=!1)});function O(a){c.object.isPerspectiveCamera?m/=a:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*a)),c.object.updateProjectionMatrix(),o=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function P(a){c.object.isPerspectiveCamera?m*=a:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom/a)),c.object.updateProjectionMatrix(),o=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),c.enableZoom=!1)}function Q(a){p.set(a.clientX,a.clientY)}function R(a){s.set(a.clientX,a.clientY)}function S(a){if(1==a.touches.length)p.set(a.touches[0].pageX,a.touches[0].pageY);else{var b=.5*(a.touches[0].pageX+a.touches[1].pageX),c=.5*(a.touches[0].pageY+a.touches[1].pageY);p.set(b,c)}}function T(a){if(1==a.touches.length)s.set(a.touches[0].pageX,a.touches[0].pageY);else{var b=.5*(a.touches[0].pageX+a.touches[1].pageX),c=.5*(a.touches[0].pageY+a.touches[1].pageY);s.set(b,c)}}function U(a){var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;v.set(0,Math.sqrt(b*b+c*c))}function V(a){if(1==a.touches.length)q.set(a.touches[0].pageX,a.touches[0].pageY);else{var b=.5*(a.touches[0].pageX+a.touches[1].pageX),d=.5*(a.touches[0].pageY+a.touches[1].pageY);q.set(b,d)}r.subVectors(q,p).multiplyScalar(c.rotateSpeed);var e=c.domElement;A(2*Math.PI*r.x/e.clientHeight),B(2*Math.PI*r.y/e.clientHeight),p.copy(q)}function W(a){if(1==a.touches.length)t.set(a.touches[0].pageX,a.touches[0].pageY);else{var b=.5*(a.touches[0].pageX+a.touches[1].pageX),d=.5*(a.touches[0].pageY+a.touches[1].pageY);t.set(b,d)}u.subVectors(t,s).multiplyScalar(c.panSpeed),N(u.x,u.y),s.copy(t)}function X(a){var b=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY;w.set(0,Math.sqrt(b*b+d*d)),x.set(0,Math.pow(w.y/v.y,c.zoomSpeed)),O(x.y),v.copy(w)}function Y(a){if(!1!==c.enabled)switch(a.pointerType){case"mouse":case"pen":_(a)}}function Z(a){if(!1!==c.enabled)switch(a.pointerType){case"mouse":case"pen":aa(a)}}function $(a){if(!1!==c.enabled)switch(a.pointerType){case"mouse":case"pen":ab(a)}}function _(a){var b,e;switch(a.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),a.button){case 0:b=c.mouseButtons.LEFT;break;case 1:b=c.mouseButtons.MIDDLE;break;case 2:b=c.mouseButtons.RIGHT;break;default:b=-1}switch(b){case d.RsA.DOLLY:if(!1===c.enableZoom)return;e=a,v.set(e.clientX,e.clientY),i=h.DOLLY;break;case d.RsA.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(!1===c.enablePan)return;R(a),i=h.PAN}else{if(!1===c.enableRotate)return;Q(a),i=h.ROTATE}break;case d.RsA.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(!1===c.enableRotate)return;Q(a),i=h.ROTATE}else{if(!1===c.enablePan)return;R(a),i=h.PAN}break;default:i=h.NONE}i!==h.NONE&&(c.domElement.ownerDocument.addEventListener("pointermove",Z,!1),c.domElement.ownerDocument.addEventListener("pointerup",$,!1),c.dispatchEvent(f))}function aa(a){var b,d,e,f;if(!1!==c.enabled)switch(a.preventDefault(),i){case h.ROTATE:if(!1===c.enableRotate)return;b=a,q.set(b.clientX,b.clientY),r.subVectors(q,p).multiplyScalar(c.rotateSpeed),d=c.domElement,A(2*Math.PI*r.x/d.clientHeight),B(2*Math.PI*r.y/d.clientHeight),p.copy(q),c.update();break;case h.DOLLY:if(!1===c.enableZoom)return;e=a,w.set(e.clientX,e.clientY),x.subVectors(w,v),x.y>0?O(z()):x.y<0&&P(z()),v.copy(w),c.update();break;case h.PAN:if(!1===c.enablePan)return;f=a,t.set(f.clientX,f.clientY),u.subVectors(t,s).multiplyScalar(c.panSpeed),N(u.x,u.y),s.copy(t),c.update()}}function ab(a){!1!==c.enabled&&(c.domElement.ownerDocument.removeEventListener("pointermove",Z,!1),c.domElement.ownerDocument.removeEventListener("pointerup",$,!1),c.dispatchEvent(g),i=h.NONE)}function ac(a){if(!1!==c.enabled&& !1!==c.enableZoom&&(i===h.NONE||i===h.ROTATE)){var b;a.preventDefault(),a.stopPropagation(),c.dispatchEvent(f),(b=a).deltaY<0?P(z()):b.deltaY>0&&O(z()),c.update(),c.dispatchEvent(g)}}function ad(a){!1!==c.enabled&& !1!==c.enableKeys&& !1!==c.enablePan&&function(a){var b=!1;switch(a.keyCode){case c.keys.UP:N(0,c.keyPanSpeed),b=!0;break;case c.keys.BOTTOM:N(0,-c.keyPanSpeed),b=!0;break;case c.keys.LEFT:N(c.keyPanSpeed,0),b=!0;break;case c.keys.RIGHT:N(-c.keyPanSpeed,0),b=!0}b&&(a.preventDefault(),c.update())}(a)}function ae(a){if(!1!==c.enabled){switch(a.preventDefault(),a.touches.length){case 1:switch(c.touches.ONE){case d.QmN.ROTATE:if(!1===c.enableRotate)return;S(a),i=h.TOUCH_ROTATE;break;case d.QmN.PAN:if(!1===c.enablePan)return;T(a),i=h.TOUCH_PAN;break;default:i=h.NONE}break;case 2:var b,e;switch(c.touches.TWO){case d.QmN.DOLLY_PAN:if(!1===c.enableZoom&& !1===c.enablePan)return;b=a,c.enableZoom&&U(b),c.enablePan&&T(b),i=h.TOUCH_DOLLY_PAN;break;case d.QmN.DOLLY_ROTATE:if(!1===c.enableZoom&& !1===c.enableRotate)return;e=a,c.enableZoom&&U(e),c.enableRotate&&S(e),i=h.TOUCH_DOLLY_ROTATE;break;default:i=h.NONE}break;default:i=h.NONE}i!==h.NONE&&c.dispatchEvent(f)}}function af(a){var b,d;if(!1!==c.enabled)switch(a.preventDefault(),a.stopPropagation(),i){case h.TOUCH_ROTATE:if(!1===c.enableRotate)return;V(a),c.update();break;case h.TOUCH_PAN:if(!1===c.enablePan)return;W(a),c.update();break;case h.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&& !1===c.enablePan)return;b=a,c.enableZoom&&X(b),c.enablePan&&W(b),c.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&& !1===c.enableRotate)return;d=a,c.enableZoom&&X(d),c.enableRotate&&V(d),c.update();break;default:i=h.NONE}}function ag(a){!1!==c.enabled&&(c.dispatchEvent(g),i=h.NONE)}function ah(a){!1!==c.enabled&&a.preventDefault()}c.domElement.addEventListener("contextmenu",ah,!1),c.domElement.addEventListener("pointerdown",Y,!1),c.domElement.addEventListener("wheel",ac,!1),c.domElement.addEventListener("touchstart",ae,!1),c.domElement.addEventListener("touchend",ag,!1),c.domElement.addEventListener("touchmove",af,!1),c.domElement.addEventListener("keydown",ad,!1),-1===c.domElement.tabIndex&&(c.domElement.tabIndex=0),this.update()};e.prototype=Object.create(d.pBf.prototype),e.prototype.constructor=e;var f=function(a,b){e.call(this,a,b),this.screenSpacePanning=!1,this.mouseButtons.LEFT=d.RsA.PAN,this.mouseButtons.RIGHT=d.RsA.ROTATE,this.touches.ONE=d.QmN.PAN,this.touches.TWO=d.QmN.DOLLY_ROTATE};f.prototype=Object.create(d.pBf.prototype),f.prototype.constructor=f},7047:function(a,b,c){c.d(b,{E:function(){return e}});var d=c(2212),e=function(){function a(a){d.aNw.call(this,a),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.pluginCallbacks=[],this.register(function(a){return new h(a)}),this.register(function(a){return new j(a)}),this.register(function(a){return new i(a)}),this.register(function(a){return new f(a)})}function b(){var a={};return{get:function(b){return a[b]},add:function(b,c){a[b]=c},remove:function(b){delete a[b]},removeAll:function(){a={}}}}a.prototype=Object.assign(Object.create(d.aNw.prototype),{constructor:a,load:function(a,b,c,e){var f,g=this;f=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:d.Zp0.extractUrlBase(a),this.manager.itemStart(a);var h=function(b){e?e(b):console.error(b),g.manager.itemError(a),g.manager.itemEnd(a)},i=new d.hH6(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(a,function(c){try{g.parse(c,f,function(c){b(c),g.manager.itemEnd(a)},h)}catch(d){h(d)}},c,h)},setDRACOLoader:function(a){return this.dracoLoader=a,this},setDDSLoader:function(a){return this.ddsLoader=a,this},setKTX2Loader:function(a){return this.ktx2Loader=a,this},register:function(a){return -1===this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.push(a),this},unregister:function(a){return -1!==this.pluginCallbacks.indexOf(a)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(a),1),this},parse:function(a,b,f,h){var i,j={},l={};if("string"==typeof a)i=a;else if(d.Zp0.decodeText(new Uint8Array(a,0,4))===k){try{j[c.KHR_BINARY_GLTF]=new n(a)}catch(m){h&&h(m);return}i=j[c.KHR_BINARY_GLTF].content}else i=d.Zp0.decodeText(new Uint8Array(a));var q=JSON.parse(i);if(void 0===q.asset||q.asset.version[0]<2){h&&h(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}var t=new K(q,{path:b||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader});t.fileLoader.setRequestHeader(this.requestHeader);for(var u=0;u<this.pluginCallbacks.length;u++){var v=this.pluginCallbacks[u](t);l[v.name]=v,j[v.name]=!0}if(q.extensionsUsed)for(var u=0;u<q.extensionsUsed.length;++u){var w=q.extensionsUsed[u],x=q.extensionsRequired||[];switch(w){case c.KHR_MATERIALS_UNLIT:j[w]=new g;break;case c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:j[w]=new r;break;case c.KHR_DRACO_MESH_COMPRESSION:j[w]=new o(q,this.dracoLoader);break;case c.MSFT_TEXTURE_DDS:j[w]=new e(this.ddsLoader);break;case c.KHR_TEXTURE_TRANSFORM:j[w]=new p;break;case c.KHR_MESH_QUANTIZATION:j[w]=new s;break;default:x.indexOf(w)>=0&& void 0===l[w]&&console.warn('THREE.GLTFLoader: Unknown extension "'+w+'".')}}t.setExtensions(j),t.setPlugins(l),t.parse(f,h)}});var c={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function e(a){if(!a)throw Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=c.MSFT_TEXTURE_DDS,this.ddsLoader=a}function f(a){this.parser=a,this.name=c.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function g(){this.name=c.KHR_MATERIALS_UNLIT}function h(a){this.parser=a,this.name=c.KHR_MATERIALS_CLEARCOAT}function i(a){this.parser=a,this.name=c.KHR_MATERIALS_TRANSMISSION}function j(a){this.parser=a,this.name=c.KHR_TEXTURE_BASISU}f.prototype._markDefs=function(){for(var a=this.parser,b=this.parser.json.nodes||[],c=0,d=b.length;c<d;c++){var e=b[c];e.extensions&&e.extensions[this.name]&& void 0!==e.extensions[this.name].light&&a._addNodeRef(this.cache,e.extensions[this.name].light)}},f.prototype._loadLight=function(a){var b,c=this.parser,e="light:"+a,f=c.cache.get(e);if(f)return f;var g=c.json,h=((g.extensions&&g.extensions[this.name]||{}).lights||[])[a],i=new d.Ilk(16777215);void 0!==h.color&&i.fromArray(h.color);var j=void 0!==h.range?h.range:0;switch(h.type){case"directional":(b=new d.Ox3(i)).target.position.set(0,0,-1),b.add(b.target);break;case"point":(b=new d.cek(i)).distance=j;break;case"spot":(b=new d.PMe(i)).distance=j,h.spot=h.spot||{},h.spot.innerConeAngle=void 0!==h.spot.innerConeAngle?h.spot.innerConeAngle:0,h.spot.outerConeAngle=void 0!==h.spot.outerConeAngle?h.spot.outerConeAngle:Math.PI/4,b.angle=h.spot.outerConeAngle,b.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,b.target.position.set(0,0,-1),b.add(b.target);break;default:throw Error('THREE.GLTFLoader: Unexpected light type, "'+h.type+'".')}return b.position.set(0,0,0),b.decay=2,void 0!==h.intensity&&(b.intensity=h.intensity),b.name=c.createUniqueName(h.name||"light_"+a),f=Promise.resolve(b),c.cache.add(e,f),f},f.prototype.createNodeAttachment=function(a){var b=this,c=this.parser,d=c.json.nodes[a],e=(d.extensions&&d.extensions[this.name]||{}).light;return void 0===e?null:this._loadLight(e).then(function(a){return c._getNodeRef(b.cache,e,a)})},g.prototype.getMaterialType=function(){return d.vBJ},g.prototype.extendParams=function(a,b,c){var e=[];a.color=new d.Ilk(1,1,1),a.opacity=1;var f=b.pbrMetallicRoughness;if(f){if(Array.isArray(f.baseColorFactor)){var g=f.baseColorFactor;a.color.fromArray(g),a.opacity=g[3]}void 0!==f.baseColorTexture&&e.push(c.assignTexture(a,"map",f.baseColorTexture))}return Promise.all(e)},h.prototype.getMaterialType=function(a){var b=this.parser.json.materials[a];return b.extensions&&b.extensions[this.name]?d.EJi:null},h.prototype.extendMaterialParams=function(a,b){var c=this.parser,e=c.json.materials[a];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();var f=[],g=e.extensions[this.name];if(void 0!==g.clearcoatFactor&&(b.clearcoat=g.clearcoatFactor),void 0!==g.clearcoatTexture&&f.push(c.assignTexture(b,"clearcoatMap",g.clearcoatTexture)),void 0!==g.clearcoatRoughnessFactor&&(b.clearcoatRoughness=g.clearcoatRoughnessFactor),void 0!==g.clearcoatRoughnessTexture&&f.push(c.assignTexture(b,"clearcoatRoughnessMap",g.clearcoatRoughnessTexture)),void 0!==g.clearcoatNormalTexture&&(f.push(c.assignTexture(b,"clearcoatNormalMap",g.clearcoatNormalTexture)),void 0!==g.clearcoatNormalTexture.scale)){var h=g.clearcoatNormalTexture.scale;b.clearcoatNormalScale=new d.FM8(h,h)}return Promise.all(f)},i.prototype.getMaterialType=function(a){var b=this.parser.json.materials[a];return b.extensions&&b.extensions[this.name]?d.EJi:null},i.prototype.extendMaterialParams=function(a,b){var c=this.parser,d=c.json.materials[a];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();var e=[],f=d.extensions[this.name];return void 0!==f.transmissionFactor&&(b.transmission=f.transmissionFactor),void 0!==f.transmissionTexture&&e.push(c.assignTexture(b,"transmissionMap",f.transmissionTexture)),Promise.all(e)},j.prototype.loadTexture=function(a){var b=this.parser,c=b.json,d=c.textures[a];if(!d.extensions||!d.extensions[this.name])return null;var e=d.extensions[this.name],f=c.images[e.source],g=b.options.ktx2Loader;if(!g)throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return b.loadTextureImage(a,f,g)};var k="glTF",l=12,m={JSON:1313821514,BIN:5130562};function n(a){this.name=c.KHR_BINARY_GLTF,this.content=null,this.body=null;var b=new DataView(a,0,l);if(this.header={magic:d.Zp0.decodeText(new Uint8Array(a.slice(0,4))),version:b.getUint32(4,!0),length:b.getUint32(8,!0)},this.header.magic!==k)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");for(var e=new DataView(a,l),f=0;f<e.byteLength;){var g=e.getUint32(f,!0);f+=4;var h=e.getUint32(f,!0);if(f+=4,h===m.JSON){var i=new Uint8Array(a,l+f,g);this.content=d.Zp0.decodeText(i)}else if(h===m.BIN){var j=l+f;this.body=a.slice(j,j+g)}f+=g}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}function o(a,b){if(!b)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=c.KHR_DRACO_MESH_COMPRESSION,this.json=a,this.dracoLoader=b,this.dracoLoader.preload()}function p(){this.name=c.KHR_TEXTURE_TRANSFORM}function q(a){d.Wid.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var b={specular:{value:new d.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=b,this.onBeforeCompile=function(a){for(var c in b)a.uniforms[c]=b[c];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n	uniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	texelSpecular = sRGBToLinear( texelSpecular );\n	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n	specularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>","float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n	vec4 texelGlossiness = texture2D( glossinessMap, vUv );\n	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n	glossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\nmaterial.specularColor = specularFactor;")},Object.defineProperties(this,{specular:{get:function(){return b.specular.value},set:function(a){b.specular.value=a}},specularMap:{get:function(){return b.specularMap.value},set:function(a){b.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return b.glossiness.value},set:function(a){b.glossiness.value=a}},glossinessMap:{get:function(){return b.glossinessMap.value},set:function(a){b.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(a)}function r(){return{name:c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio",],getMaterialType:function(){return q},extendParams:function(a,b,c){var e=b.extensions[this.name];a.color=new d.Ilk(1,1,1),a.opacity=1;var f=[];if(Array.isArray(e.diffuseFactor)){var g=e.diffuseFactor;a.color.fromArray(g),a.opacity=g[3]}if(void 0!==e.diffuseTexture&&f.push(c.assignTexture(a,"map",e.diffuseTexture)),a.emissive=new d.Ilk(0,0,0),a.glossiness=void 0!==e.glossinessFactor?e.glossinessFactor:1,a.specular=new d.Ilk(1,1,1),Array.isArray(e.specularFactor)&&a.specular.fromArray(e.specularFactor),void 0!==e.specularGlossinessTexture){var h=e.specularGlossinessTexture;f.push(c.assignTexture(a,"glossinessMap",h)),f.push(c.assignTexture(a,"specularMap",h))}return Promise.all(f)},createMaterial:function(a){var b=new q(a);return b.fog=!0,b.color=a.color,b.map=void 0===a.map?null:a.map,b.lightMap=null,b.lightMapIntensity=1,b.aoMap=void 0===a.aoMap?null:a.aoMap,b.aoMapIntensity=1,b.emissive=a.emissive,b.emissiveIntensity=1,b.emissiveMap=void 0===a.emissiveMap?null:a.emissiveMap,b.bumpMap=void 0===a.bumpMap?null:a.bumpMap,b.bumpScale=1,b.normalMap=void 0===a.normalMap?null:a.normalMap,b.normalMapType=d.IOt,a.normalScale&&(b.normalScale=a.normalScale),b.displacementMap=null,b.displacementScale=1,b.displacementBias=0,b.specularMap=void 0===a.specularMap?null:a.specularMap,b.specular=a.specular,b.glossinessMap=void 0===a.glossinessMap?null:a.glossinessMap,b.glossiness=a.glossiness,b.alphaMap=null,b.envMap=void 0===a.envMap?null:a.envMap,b.envMapIntensity=1,b.refractionRatio=.98,b}}}function s(){this.name=c.KHR_MESH_QUANTIZATION}function t(a,b,c,e){d._C8.call(this,a,b,c,e)}o.prototype.decodePrimitive=function(a,b){var c=this.json,d=this.dracoLoader,e=a.extensions[this.name].bufferView,f=a.extensions[this.name].attributes,g={},h={},i={};for(var j in f){var k=z[j]||j.toLowerCase();g[k]=f[j]}for(j in a.attributes){var k=z[j]||j.toLowerCase();if(void 0!==f[j]){var l=c.accessors[a.attributes[j]],m=v[l.componentType];i[k]=m,h[k]=!0===l.normalized}}return b.getDependency("bufferView",e).then(function(a){return new Promise(function(b){d.decodeDracoFile(a,function(a){for(var c in a.attributes){var d=a.attributes[c],e=h[c];void 0!==e&&(d.normalized=e)}b(a)},g,i)})})},p.prototype.extendTexture=function(a,b){return a=a.clone(),void 0!==b.offset&&a.offset.fromArray(b.offset),void 0!==b.rotation&&(a.rotation=b.rotation),void 0!==b.scale&&a.repeat.fromArray(b.scale),void 0!==b.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),a.needsUpdate=!0,a},q.prototype=Object.create(d.Wid.prototype),q.prototype.constructor=q,q.prototype.copy=function(a){return d.Wid.prototype.copy.call(this,a),this.specularMap=a.specularMap,this.specular.copy(a.specular),this.glossinessMap=a.glossinessMap,this.glossiness=a.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},t.prototype=Object.create(d._C8.prototype),t.prototype.constructor=t,t.prototype.copySampleValue_=function(a){for(var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=a*d*3+d,f=0;f!==d;f++)b[f]=c[e+f];return b},t.prototype.beforeStart_=t.prototype.copySampleValue_,t.prototype.afterEnd_=t.prototype.copySampleValue_,t.prototype.interpolate_=function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=2*g,i=3*g,j=d-b,k=(c-b)/j,l=k*k,m=l*k,n=a*i,o=n-i,p=-2*m+3*l,q=m-l,r=1-p,s=q-l+k,t=0;t!==g;t++){var u=f[o+t+g],v=f[o+t+h]*j,w=f[n+t+g],x=f[n+t]*j;e[t]=r*u+s*v+p*w+q*x}return e};var u={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},v={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},w={9728:d.TyD,9729:d.wem,9984:d.YLQ,9985:d.qyh,9986:d.aH4,9987:d.D1R},x={33071:d.uWy,33648:d.OoA,10497:d.rpg},y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},z={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},B={CUBICSPLINE:void 0,LINEAR:d.NMF,STEP:d.Syv},C={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function D(a,b){return"string"!=typeof a||""===a?"":(/^https?:\/\//i.test(b)&&/^\//.test(a)&&(b=b.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a))?a:b+a}function E(a){return void 0===a.DefaultMaterial&&(a.DefaultMaterial=new d.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:d.Wl3})),a.DefaultMaterial}function F(a,b,c){for(var d in c.extensions)void 0===a[d]&&(b.userData.gltfExtensions=b.userData.gltfExtensions||{},b.userData.gltfExtensions[d]=c.extensions[d])}function G(a,b){void 0!==b.extras&&("object"==typeof b.extras?Object.assign(a.userData,b.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+b.extras))}function H(a,b){if(a.updateMorphTargets(),void 0!==b.weights)for(var c=0,d=b.weights.length;c<d;c++)a.morphTargetInfluences[c]=b.weights[c];if(b.extras&&Array.isArray(b.extras.targetNames)){var e=b.extras.targetNames;if(a.morphTargetInfluences.length===e.length){a.morphTargetDictionary={};for(var c=0,d=e.length;c<d;c++)a.morphTargetDictionary[e[c]]=c}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function I(a){var b,d=a.extensions&&a.extensions[c.KHR_DRACO_MESH_COMPRESSION];return d?"draco:"+d.bufferView+":"+d.indices+":"+J(d.attributes):a.indices+":"+J(a.attributes)+":"+a.mode}function J(a){for(var b="",c=Object.keys(a).sort(),d=0,e=c.length;d<e;d++)b+=c[d]+":"+a[c[d]]+";";return b}function K(a,c){this.json=a||{},this.extensions={},this.plugins={},this.options=c||{},this.cache=new b,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&& !1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new d.QRU(this.options.manager):this.textureLoader=new d.dpR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new d.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function L(a,b,c){var e=b.attributes,f=[];function g(b,d){return c.getDependency("accessor",b).then(function(b){a.setAttribute(d,b)})}for(var h in e){var i=z[h]||h.toLowerCase();i in a.attributes||f.push(g(e[h],i))}if(void 0!==b.indices&&!a.index){var j=c.getDependency("accessor",b.indices).then(function(b){a.setIndex(b)});f.push(j)}return G(a,b),!function(a,b,c){var e=b.attributes,f=new d.ZzF;if(void 0!==e.POSITION){var g=c.json.accessors[e.POSITION],h=g.min,i=g.max;if(void 0!==h&& void 0!==i)f.set(new d.Pa4(h[0],h[1],h[2]),new d.Pa4(i[0],i[1],i[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}var j=b.targets;if(void 0!==j){for(var k=new d.Pa4,l=new d.Pa4,m=0,n=j.length;m<n;m++){var o=j[m];if(void 0!==o.POSITION){var g=c.json.accessors[o.POSITION],h=g.min,i=g.max;void 0!==h&& void 0!==i?(l.setX(Math.max(Math.abs(h[0]),Math.abs(i[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(i[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(i[2]))),k.max(l)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}f.expandByVector(k)}a.boundingBox=f;var p=new d.aLr;f.getCenter(p.center),p.radius=f.min.distanceTo(f.max)/2,a.boundingSphere=p}}(a,b,c),Promise.all(f).then(function(){return void 0!==b.targets?function(a,b,c){for(var d=!1,e=!1,f=0,g=b.length;f<g;f++){var h=b[f];if(void 0!==h.POSITION&&(d=!0),void 0!==h.NORMAL&&(e=!0),d&&e)break}if(!d&&!e)return Promise.resolve(a);for(var i=[],j=[],f=0,g=b.length;f<g;f++){var h=b[f];if(d){var k=void 0!==h.POSITION?c.getDependency("accessor",h.POSITION):a.attributes.position;i.push(k)}if(e){var k=void 0!==h.NORMAL?c.getDependency("accessor",h.NORMAL):a.attributes.normal;j.push(k)}}return Promise.all([Promise.all(i),Promise.all(j)]).then(function(b){var c=b[0],f=b[1];return d&&(a.morphAttributes.position=c),e&&(a.morphAttributes.normal=f),a.morphTargetsRelative=!0,a})}(a,b.targets,c):a})}function M(a,b){var c=a.getIndex();if(null===c){var e=[],f=a.getAttribute("position");if(void 0===f)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a;for(var g=0;g<f.count;g++)e.push(g);a.setIndex(e),c=a.getIndex()}var h=c.count-2,i=[];if(b===d.z$h)for(var g=1;g<=h;g++)i.push(c.getX(0)),i.push(c.getX(g)),i.push(c.getX(g+1));else for(var g=0;g<h;g++)g%2==0?(i.push(c.getX(g)),i.push(c.getX(g+1)),i.push(c.getX(g+2))):(i.push(c.getX(g+2)),i.push(c.getX(g+1)),i.push(c.getX(g)));i.length/3!==h&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var j=a.clone();return j.setIndex(i),j}return K.prototype.setExtensions=function(a){this.extensions=a},K.prototype.setPlugins=function(a){this.plugins=a},K.prototype.parse=function(a,b){var c=this,d=this.json,e=this.extensions;this.cache.removeAll(),this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera"),]).then(function(b){var f={scene:b[0][d.scene||0],scenes:b[0],animations:b[1],cameras:b[2],asset:d.asset,parser:c,userData:{}};F(e,f,d),G(f,d),a(f)}).catch(b)},K.prototype._markDefs=function(){for(var a=this.json.nodes||[],b=this.json.skins||[],c=this.json.meshes||[],d=0,e=b.length;d<e;d++)for(var f=b[d].joints,g=0,h=f.length;g<h;g++)a[f[g]].isBone=!0;for(var i=0,j=a.length;i<j;i++){var k=a[i];void 0!==k.mesh&&(this._addNodeRef(this.meshCache,k.mesh),void 0!==k.skin&&(c[k.mesh].isSkinnedMesh=!0)),void 0!==k.camera&&this._addNodeRef(this.cameraCache,k.camera)}},K.prototype._addNodeRef=function(a,b){void 0!==b&&(void 0===a.refs[b]&&(a.refs[b]=a.uses[b]=0),a.refs[b]++)},K.prototype._getNodeRef=function(a,b,c){if(a.refs[b]<=1)return c;var d=c.clone();return d.name+="_instance_"+a.uses[b]++,d},K.prototype._invokeOne=function(a){var b=Object.values(this.plugins);b.push(this);for(var c=0;c<b.length;c++){var d=a(b[c]);if(d)return d}},K.prototype._invokeAll=function(a){var b=Object.values(this.plugins);b.unshift(this);for(var c=[],d=0;d<b.length;d++){var e=a(b[d]);e&&c.push(e)}return c},K.prototype.getDependency=function(a,b){var c=a+":"+b,d=this.cache.get(c);if(!d){switch(a){case"scene":d=this.loadScene(b);break;case"node":d=this.loadNode(b);break;case"mesh":d=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(b)});break;case"accessor":d=this.loadAccessor(b);break;case"bufferView":d=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(b)});break;case"buffer":d=this.loadBuffer(b);break;case"material":d=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(b)});break;case"texture":d=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(b)});break;case"skin":d=this.loadSkin(b);break;case"animation":d=this.loadAnimation(b);break;case"camera":d=this.loadCamera(b);break;default:throw Error("Unknown type: "+a)}this.cache.add(c,d)}return d},K.prototype.getDependencies=function(a){var b=this.cache.get(a);if(!b){var c=this;b=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(b,d){return c.getDependency(a,d)})),this.cache.add(a,b)}return b},K.prototype.loadBuffer=function(a){var b=this.json.buffers[a],d=this.fileLoader;if(b.type&&"arraybuffer"!==b.type)throw Error("THREE.GLTFLoader: "+b.type+" buffer type is not supported.");if(void 0===b.uri&&0===a)return Promise.resolve(this.extensions[c.KHR_BINARY_GLTF].body);var e=this.options;return new Promise(function(a,c){d.load(D(b.uri,e.path),a,void 0,function(){c(Error('THREE.GLTFLoader: Failed to load buffer "'+b.uri+'".'))})})},K.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteLength||0,d=b.byteOffset||0;return a.slice(d,d+c)})},K.prototype.loadAccessor=function(a){var b=this,c=this.json,e=this.json.accessors[a];if(void 0===e.bufferView&& void 0===e.sparse)return Promise.resolve(null);var f=[];return void 0!==e.bufferView?f.push(this.getDependency("bufferView",e.bufferView)):f.push(null),void 0!==e.sparse&&(f.push(this.getDependency("bufferView",e.sparse.indices.bufferView)),f.push(this.getDependency("bufferView",e.sparse.values.bufferView))),Promise.all(f).then(function(a){var f,g,h=a[0],i=y[e.type],j=v[e.componentType],k=j.BYTES_PER_ELEMENT,l=e.byteOffset||0,m=void 0!==e.bufferView?c.bufferViews[e.bufferView].byteStride:void 0,n=!0===e.normalized;if(m&&m!==k*i){var o=Math.floor(l/m),p="InterleavedBuffer:"+e.bufferView+":"+e.componentType+":"+o+":"+e.count,q=b.cache.get(p);q||(f=new j(h,o*m,e.count*m/k),q=new d.vpT(f,m/k),b.cache.add(p,q)),g=new d.kB5(q,i,l%m/k,n)}else f=null===h?new j(e.count*i):new j(h,l,e.count*i),g=new d.TlE(f,i,n);if(void 0!==e.sparse){var r=y.SCALAR,s=v[e.sparse.indices.componentType],t=e.sparse.indices.byteOffset||0,u=e.sparse.values.byteOffset||0,w=new s(a[1],t,e.sparse.count*r),x=new j(a[2],u,e.sparse.count*i);null!==h&&(g=new d.TlE(g.array.slice(),g.itemSize,g.normalized));for(var z=0,A=w.length;z<A;z++){var B=w[z];if(g.setX(B,x[z*i]),i>=2&&g.setY(B,x[z*i+1]),i>=3&&g.setZ(B,x[z*i+2]),i>=4&&g.setW(B,x[z*i+3]),i>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})},K.prototype.loadTexture=function(a){var b,d,e=this.json,f=this.options,g=e.textures[a],h=g.extensions||{};return(b=h[c.MSFT_TEXTURE_DDS]?e.images[h[c.MSFT_TEXTURE_DDS].source]:e.images[g.source]).uri&&(d=f.manager.getHandler(b.uri)),d||(d=h[c.MSFT_TEXTURE_DDS]?this.extensions[c.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(a,b,d)},K.prototype.loadTextureImage=function(a,b,c){var e=this,f=this.json,g=this.options,h=f.textures[a],i=self.URL||self.webkitURL,j=b.uri,k=!1,l=!0;return"image/jpeg"===b.mimeType&&(l=!1),void 0!==b.bufferView&&(j=e.getDependency("bufferView",b.bufferView).then(function(a){if("image/png"===b.mimeType){var c=new DataView(a,25,1).getUint8(0,!1);l=6===c||4===c||3===c}k=!0;var d=new Blob([a],{type:b.mimeType});return j=i.createObjectURL(d)})),Promise.resolve(j).then(function(a){return new Promise(function(b,e){var f=b;!0===c.isImageBitmapLoader&&(f=function(a){b(new d.ROQ(a))}),c.load(D(a,g.path),f,void 0,e)})}).then(function(b){!0===k&&i.revokeObjectURL(j),b.flipY=!1,h.name&&(b.name=h.name),l||(b.format=d.UCm);var c=(f.samplers||{})[h.sampler]||{};return b.magFilter=w[c.magFilter]||d.wem,b.minFilter=w[c.minFilter]||d.D1R,b.wrapS=x[c.wrapS]||d.rpg,b.wrapT=x[c.wrapT]||d.rpg,e.associations.set(b,{type:"textures",index:a}),b})},K.prototype.assignTexture=function(a,b,d){var e=this;return this.getDependency("texture",d.index).then(function(f){if(void 0===d.texCoord||0==d.texCoord||"aoMap"===b&&1==d.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+d.texCoord+" for texture "+b+" not yet supported."),e.extensions[c.KHR_TEXTURE_TRANSFORM]){var g=void 0!==d.extensions?d.extensions[c.KHR_TEXTURE_TRANSFORM]:void 0;if(g){var h=e.associations.get(f);f=e.extensions[c.KHR_TEXTURE_TRANSFORM].extendTexture(f,g),e.associations.set(f,h)}}a[b]=f})},K.prototype.assignFinalMaterial=function(a){var b=a.geometry,c=a.material,e=void 0!==b.attributes.tangent,f=void 0!==b.attributes.color,g=void 0===b.attributes.normal,h=!0===a.isSkinnedMesh,i=Object.keys(b.morphAttributes).length>0,j=i&& void 0!==b.morphAttributes.normal;if(a.isPoints){var k="PointsMaterial:"+c.uuid,l=this.cache.get(k);l||(l=new d.UY4,d.F5T.prototype.copy.call(l,c),l.color.copy(c.color),l.map=c.map,l.sizeAttenuation=!1,this.cache.add(k,l)),c=l}else if(a.isLine){var k="LineBasicMaterial:"+c.uuid,m=this.cache.get(k);m||(m=new d.nls,d.F5T.prototype.copy.call(m,c),m.color.copy(c.color),this.cache.add(k,m)),c=m}if(e||f||g||h||i){var k="ClonedMaterial:"+c.uuid+":";c.isGLTFSpecularGlossinessMaterial&&(k+="specular-glossiness:"),h&&(k+="skinning:"),e&&(k+="vertex-tangents:"),f&&(k+="vertex-colors:"),g&&(k+="flat-shading:"),i&&(k+="morph-targets:"),j&&(k+="morph-normals:");var n=this.cache.get(k);n||(n=c.clone(),h&&(n.skinning=!0),e&&(n.vertexTangents=!0),f&&(n.vertexColors=!0),g&&(n.flatShading=!0),i&&(n.morphTargets=!0),j&&(n.morphNormals=!0),this.cache.add(k,n),this.associations.set(n,this.associations.get(c))),c=n}c.aoMap&& void 0===b.attributes.uv2&& void 0!==b.attributes.uv&&b.setAttribute("uv2",b.attributes.uv),c.normalScale&&!e&&(c.normalScale.y=-c.normalScale.y),c.clearcoatNormalScale&&!e&&(c.clearcoatNormalScale.y=-c.clearcoatNormalScale.y),a.material=c},K.prototype.getMaterialType=function(){return d.Wid},K.prototype.loadMaterial=function(a){var b,e=this,f=this.json,g=this.extensions,h=f.materials[a],i={},j=h.extensions||{},k=[];if(j[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=g[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];b=l.getMaterialType(),k.push(l.extendParams(i,h,e))}else if(j[c.KHR_MATERIALS_UNLIT]){var m=g[c.KHR_MATERIALS_UNLIT];b=m.getMaterialType(),k.push(m.extendParams(i,h,e))}else{var n=h.pbrMetallicRoughness||{};if(i.color=new d.Ilk(1,1,1),i.opacity=1,Array.isArray(n.baseColorFactor)){var o=n.baseColorFactor;i.color.fromArray(o),i.opacity=o[3]}void 0!==n.baseColorTexture&&k.push(e.assignTexture(i,"map",n.baseColorTexture)),i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(k.push(e.assignTexture(i,"metalnessMap",n.metallicRoughnessTexture)),k.push(e.assignTexture(i,"roughnessMap",n.metallicRoughnessTexture))),b=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(a)}),k.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(a,i)})))}!0===h.doubleSided&&(i.side=d.ehD);var p=h.alphaMode||C.OPAQUE;return p===C.BLEND?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,p===C.MASK&&(i.alphaTest=void 0!==h.alphaCutoff?h.alphaCutoff:.5)),void 0!==h.normalTexture&&b!==d.vBJ&&(k.push(e.assignTexture(i,"normalMap",h.normalTexture)),i.normalScale=new d.FM8(1,1),void 0!==h.normalTexture.scale&&i.normalScale.set(h.normalTexture.scale,h.normalTexture.scale)),void 0!==h.occlusionTexture&&b!==d.vBJ&&(k.push(e.assignTexture(i,"aoMap",h.occlusionTexture)),void 0!==h.occlusionTexture.strength&&(i.aoMapIntensity=h.occlusionTexture.strength)),void 0!==h.emissiveFactor&&b!==d.vBJ&&(i.emissive=new d.Ilk().fromArray(h.emissiveFactor)),void 0!==h.emissiveTexture&&b!==d.vBJ&&k.push(e.assignTexture(i,"emissiveMap",h.emissiveTexture)),Promise.all(k).then(function(){var f;return f=b===q?g[c.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new b(i),h.name&&(f.name=h.name),f.map&&(f.map.encoding=d.knz),f.emissiveMap&&(f.emissiveMap.encoding=d.knz),G(f,h),e.associations.set(f,{type:"materials",index:a}),h.extensions&&F(g,f,h),f})},K.prototype.createUniqueName=function(a){for(var b=d.iUV.sanitizeNodeName(a||""),c=1;this.nodeNamesUsed[b];++c)b=a+"_"+c;return this.nodeNamesUsed[b]=!0,b},K.prototype.loadGeometries=function(a){var b=this,e=this.extensions,f=this.primitiveCache;function g(a){return e[c.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,b).then(function(c){return L(c,a,b)})}for(var h=[],i=0,j=a.length;i<j;i++){var k,l=a[i],m=I(l),n=f[m];n?h.push(n.promise):(k=l.extensions&&l.extensions[c.KHR_DRACO_MESH_COMPRESSION]?g(l):L(new d.u9r,l,b),f[m]={primitive:l,promise:k},h.push(k))}return Promise.all(h)},K.prototype.loadMesh=function(a){for(var b=this,c=this.json.meshes[a],e=c.primitives,f=[],g=0,h=e.length;g<h;g++){var i=void 0===e[g].material?E(this.cache):this.getDependency("material",e[g].material);f.push(i)}return f.push(b.loadGeometries(e)),Promise.all(f).then(function(f){for(var g=f.slice(0,f.length-1),h=f[f.length-1],i=[],j=0,k=h.length;j<k;j++){var l,m=h[j],n=e[j],o=g[j];if(n.mode===u.TRIANGLES||n.mode===u.TRIANGLE_STRIP||n.mode===u.TRIANGLE_FAN|| void 0===n.mode)!0!==(l=!0===c.isSkinnedMesh?new d.TUv(m,o):new d.Kj0(m,o)).isSkinnedMesh||l.geometry.attributes.skinWeight.normalized||l.normalizeSkinWeights(),n.mode===u.TRIANGLE_STRIP?l.geometry=M(l.geometry,d.UlW):n.mode===u.TRIANGLE_FAN&&(l.geometry=M(l.geometry,d.z$h));else if(n.mode===u.LINES)l=new d.ejS(m,o);else if(n.mode===u.LINE_STRIP)l=new d.x12(m,o);else if(n.mode===u.LINE_LOOP)l=new d.blk(m,o);else if(n.mode===u.POINTS)l=new d.woe(m,o);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+n.mode);Object.keys(l.geometry.morphAttributes).length>0&&H(l,c),l.name=b.createUniqueName(c.name||"mesh_"+a),h.length>1&&(l.name+="_"+j),G(l,c),b.assignFinalMaterial(l),i.push(l)}if(1===i.length)return i[0];for(var p=new d.ZAu,j=0,k=i.length;j<k;j++)p.add(i[j]);return p})},K.prototype.loadCamera=function(a){var b,c=this.json.cameras[a],e=c[c.type];if(!e){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===c.type?b=new d.cPb(d.M8C.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===c.type&&(b=new d.iKG(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),c.name&&(b.name=this.createUniqueName(c.name)),G(b,c),Promise.resolve(b)},K.prototype.loadSkin=function(a){var b=this.json.skins[a],c={joints:b.joints};return void 0===b.inverseBindMatrices?Promise.resolve(c):this.getDependency("accessor",b.inverseBindMatrices).then(function(a){return c.inverseBindMatrices=a,c})},K.prototype.loadAnimation=function(a){for(var b=this.json.animations[a],c=[],e=[],f=[],g=[],h=[],i=0,j=b.channels.length;i<j;i++){var k=b.channels[i],l=b.samplers[k.sampler],m=k.target,n=void 0!==m.node?m.node:m.id,o=void 0!==b.parameters?b.parameters[l.input]:l.input,p=void 0!==b.parameters?b.parameters[l.output]:l.output;c.push(this.getDependency("node",n)),e.push(this.getDependency("accessor",o)),f.push(this.getDependency("accessor",p)),g.push(l),h.push(m)}return Promise.all([Promise.all(c),Promise.all(e),Promise.all(f),Promise.all(g),Promise.all(h)]).then(function(c){for(var e=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=[],k=0,l=e.length;k<l;k++){var m=e[k],n=f[k],o=g[k],p=h[k],q=i[k];if(void 0!==m){switch(m.updateMatrix(),m.matrixAutoUpdate=!0,A[q.path]){case A.weights:w=d.dUE;break;case A.rotation:w=d.iLg;break;case A.position:case A.scale:default:w=d.yC1}var r=m.name?m.name:m.uuid,s=void 0!==p.interpolation?B[p.interpolation]:d.NMF,u=[];A[q.path]===A.weights?m.traverse(function(a){!0===a.isMesh&&a.morphTargetInfluences&&u.push(a.name?a.name:a.uuid)}):u.push(r);var v=o.array;if(o.normalized){if(v.constructor===Int8Array)x=1/127;else if(v.constructor===Uint8Array)x=1/255;else if(v.constructor==Int16Array)x=1/32767;else if(v.constructor===Uint16Array)x=1/65535;else throw Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var w,x,y=new Float32Array(v.length),z=0,C=v.length;z<C;z++)y[z]=v[z]*x;v=y}for(var z=0,C=u.length;z<C;z++){var D=new w(u[z]+"."+A[q.path],n.array,v,s);"CUBICSPLINE"===p.interpolation&&(D.createInterpolant=function(a){return new t(this.times,this.values,this.getValueSize()/3,a)},D.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),j.push(D)}}}var E=b.name?b.name:"animation_"+a;return new d.m7l(E,void 0,j)})},K.prototype.loadNode=function(a){var b,c=this.json,e=this.extensions,f=this,g=c.nodes[a],h=g.name?f.createUniqueName(g.name):"";return(b=[],void 0!==g.mesh&&b.push(f.getDependency("mesh",g.mesh).then(function(a){var b=f._getNodeRef(f.meshCache,g.mesh,a);return void 0!==g.weights&&b.traverse(function(a){if(a.isMesh)for(var b=0,c=g.weights.length;b<c;b++)a.morphTargetInfluences[b]=g.weights[b]}),b})),void 0!==g.camera&&b.push(f.getDependency("camera",g.camera).then(function(a){return f._getNodeRef(f.cameraCache,g.camera,a)})),f._invokeAll(function(b){return b.createNodeAttachment&&b.createNodeAttachment(a)}).forEach(function(a){b.push(a)}),Promise.all(b)).then(function(b){var c;if((c=!0===g.isBone?new d.N$j:b.length>1?new d.ZAu:1===b.length?b[0]:new d.Tme)!==b[0])for(var i=0,j=b.length;i<j;i++)c.add(b[i]);if(g.name&&(c.userData.name=g.name,c.name=h),G(c,g),g.extensions&&F(e,c,g),void 0!==g.matrix){var k=new d.yGw;k.fromArray(g.matrix),c.applyMatrix4(k)}else void 0!==g.translation&&c.position.fromArray(g.translation),void 0!==g.rotation&&c.quaternion.fromArray(g.rotation),void 0!==g.scale&&c.scale.fromArray(g.scale);return f.associations.set(c,{type:"nodes",index:a}),c})},K.prototype.loadScene=function(){function a(b,c,e,f){var g=e.nodes[b];return f.getDependency("node",b).then(function(a){var b;return void 0===g.skin?a:f.getDependency("skin",g.skin).then(function(a){b=a;for(var c=[],d=0,e=b.joints.length;d<e;d++)c.push(f.getDependency("node",b.joints[d]));return Promise.all(c)}).then(function(c){return a.traverse(function(a){if(a.isMesh){for(var e=[],f=[],g=0,h=c.length;g<h;g++){var i=c[g];if(i){e.push(i);var j=new d.yGw;void 0!==b.inverseBindMatrices&&j.fromArray(b.inverseBindMatrices.array,16*g),f.push(j)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',b.joints[g])}a.bind(new d.OdW(e,f),a.matrixWorld)}}),a})}).then(function(b){c.add(b);var d=[];if(g.children)for(var h=g.children,i=0,j=h.length;i<j;i++){var k=h[i];d.push(a(k,b,e,f))}return Promise.all(d)})}return function(b){var c=this.json,e=this.extensions,f=this.json.scenes[b],g=new d.ZAu;f.name&&(g.name=this.createUniqueName(f.name)),G(g,f),f.extensions&&F(e,g,f);for(var h=f.nodes||[],i=[],j=0,k=h.length;j<k;j++)i.push(a(h[j],g,c,this));return Promise.all(i).then(function(){return g})}}(),a}()}}])